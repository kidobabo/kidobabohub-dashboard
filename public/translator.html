<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Translator + Language Learning â€” Kido &amp; Babo Hub</title>
  <meta name="description" content="Translator and language learning for kids: stories, alphabet practice, fun games, quizzes, rewards and voice help. Works offline with saved progress."/>
  <meta name="robots" content="index,follow"/>
  <meta name="theme-color" content="#16a34a"/>
  <link rel="canonical" href="https://kidobabohub.web.app/translator.html"/>

  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="Kido &amp; Babo Hub"/>
  <meta property="og:title" content="Translator + Language Learning â€” Kido &amp; Babo Hub"/>
  <meta property="og:description" content="Kids learn languages with stories, alphabets, quizzes, rewards and a friendly talking partner."/>
  <meta property="og:url" content="https://kidobabohub.web.app/translator.html"/>
  <meta property="og:image" content="https://kidobabohub.web.app/logo.jpg"/>
  <meta property="og:image:secure_url" content="https://kidobabohub.web.app/logo.jpg"/>

  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Translator + Language Learning â€” Kido &amp; Babo Hub"/>
  <meta name="twitter:description" content="Kids learn languages with stories, alphabets, quizzes, rewards and a friendly talking partner."/>
  <meta name="twitter:image" content="https://kidobabohub.web.app/logo.jpg"/>

  <link rel="icon" href="/logo.jpg"/>

  <style>
    :root{
      --bg:#0b1020;

      /* âœ… Make whites dimmer (grey-ish) */
      --text: rgba(234,240,255,.86);
      --muted:#b7c3ff;

      --line:rgba(255,255,255,.12);
      --shadow:0 18px 60px rgba(0,0,0,.45);
      --radius:18px;
      --accent: linear-gradient(90deg,#006600,#bb0000,#000000);

      /* âœ… Eye-care controls (global, same as homepage) */
      --kbBrightness: 1;     /* 0.65 - 1 */
      --kbTextScale: 1;      /* 0.9 - 1.25 */
      --kbBlue: 0;           /* 0 - 0.6 */
      --kbBlueHue: 35;
      --kbBlueSat: 100%;
      --kbBlueLum: 55%;
    }

    *{ box-sizing:border-box; }
    html{ font-size: calc(16px * var(--kbTextScale)); }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      /* âœ… Eye-care dim */
      filter: brightness(var(--kbBrightness));

      background: radial-gradient(1100px 560px at 10% 10%, #23316e 0%, transparent 50%),
                  radial-gradient(900px 520px at 90% 10%, #7a1b1b 0%, transparent 55%),
                  radial-gradient(800px 520px at 50% 100%, #0e5b2f 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* âœ… Warm blue-light overlay (same as homepage) */
    #kbBlueOverlay{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 999999;
      background: hsl(var(--kbBlueHue) var(--kbBlueSat) var(--kbBlueLum));
      opacity: var(--kbBlue);
      mix-blend-mode: multiply;
    }

    /* âœ… Optional soft contrast + reduce motion classes (same behavior as homepage) */
    .kb-soft .card,
    .kb-soft header,
    .kb-soft main{
      border-color: rgba(255,255,255,.08) !important;
    }
    .kb-soft .nav button,
    .kb-soft .btn,
    .kb-soft .tabBtn,
    .kb-soft .letterBtn{
      background: rgba(255,255,255,.06) !important;
      border-color: rgba(255,255,255,.10) !important;
    }
    .kb-soft .nav button:hover,
    .kb-soft .btn:hover,
    .kb-soft .tabBtn:hover,
    .kb-soft .letterBtn:hover{
      background: rgba(255,255,255,.09) !important;
      border-color: rgba(255,255,255,.14) !important;
    }
    .kb-soft p{ color: rgba(234,240,255,.78); }

    .kb-reduce-motion *{
      animation: none !important;
      transition: none !important;
      scroll-behavior: auto !important;
    }

    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px 14px 60px; }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px 14px 10px;
      border:1px solid var(--line);
      background: rgba(15, 23, 51, .55);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .brandRow{ display:flex; align-items:center; gap:12px; }
    .logo{
      width:44px; height:44px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      object-fit: cover;
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      flex: 0 0 auto;
    }

    .brand{ display:flex; flex-direction:column; gap:4px; padding: 2px 6px; }
    .brand .title{ font-weight: 900; font-size: 18px; letter-spacing: .2px; line-height: 1.1; }
    .brand .sub{
      font-size: 12px; color: var(--muted); font-weight: 700; line-height: 1.35;
    }

    .nav{ display:flex; flex-wrap:wrap; justify-content:flex-end; gap:8px; align-items:center; }
    .nav button{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      white-space:nowrap;
      font-size: 13px;
    }
    .nav button:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.24); }
    .nav button:active{ transform: translateY(1px); }

    .nav button.primary{
      background: var(--accent);
      border-color: rgba(255,255,255,.30);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      position: relative;
      overflow: hidden;
    }
    .nav button.primary.is-open::before{
      content:"";
      position:absolute;
      inset:-40%;
      background: conic-gradient(from 0deg, rgba(255,255,255,.0), rgba(255,255,255,.35), rgba(255,255,255,.0));
      animation: spinGlow 1.4s linear infinite;
      filter: blur(1px);
    }
    .nav button.primary.is-open span{ position: relative; z-index: 1; }
    @keyframes spinGlow { to { transform: rotate(360deg); } }

    main{
      margin-top: 14px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(15, 23, 51, .55);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .page{ padding: 18px 16px; }

    .card{
      background: rgba(12, 19, 48, .72);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    h1,h2{ margin:0 0 10px; font-weight: 1000; }
    h1{ font-size: 18px; }
    h2{ font-size: 16px; }
    p{ margin: 8px 0; color: rgba(234,240,255,.80); line-height: 1.55; } /* âœ… dimmer */
    .muted{ color: rgba(183,195,255,.92); font-weight: 800; font-size: 13px; }
    .mini{ font-size: 12px; font-weight: 850; color: rgba(234,240,255,.80); line-height: 1.45; } /* âœ… dimmer */

    .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap: 12px; margin-top: 12px; }
    .col-12{ grid-column: span 12; }
    .col-6{ grid-column: span 6; }
    .col-4{ grid-column: span 4; }
    @media (max-width: 860px){
      header{ flex-direction: column; align-items: stretch; }
      .nav{ justify-content:flex-start; }
      .brandRow{ justify-content:flex-start; }
      .col-6, .col-4{ grid-column: span 12; }
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    input, select, textarea{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(15, 23, 51, .55);
      color: rgba(234,240,255,.86); /* âœ… dimmer */
      font-weight: 900;
      outline: none;
      min-width: 220px;
      flex: 1;
    }
    textarea{ min-width: 100%; resize: vertical; }

    select:focus, input:focus, textarea:focus{
      outline: 3px solid rgba(183,195,255,.85);
      outline-offset: 2px;
    }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 1000;
      cursor:pointer;
      text-decoration:none;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.24); }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: var(--accent);
      border-color: rgba(255,255,255,.28);
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
    }
    .btn.green{ background: rgba(22,163,74,.25); border-color: rgba(22,163,74,.55); }
    .btn.yellow{ background: rgba(245,158,11,.18); border-color: rgba(245,158,11,.45); }
    .btn.danger{ background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.45); }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      font-weight: 900;
      font-size: 12px;
      color: rgba(234,240,255,.86); /* âœ… dimmer */
      white-space: nowrap;
    }

    .box{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px;
      font-weight: 900;
      color: rgba(234,240,255,.84); /* âœ… dimmer */
    }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
    }
    .tabBtn{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
    }
    .tabBtn.active{
      background: var(--accent);
      border-color: rgba(255,255,255,.28);
      box-shadow: 0 12px 28px rgba(0,0,0,.20);
    }

    .kpiRow{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      margin-top: 10px;
    }
    .kpi{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      min-width: 240px;
      flex: 1;
    }
    .kpi .big{ font-size: 18px; font-weight: 1000; }
    .kpi .label{ font-size: 12px; font-weight: 900; color: var(--muted); margin-top:2px; }

    .letterGrid{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin-top: 10px;
    }
    @media (max-width: 520px){
      .letterGrid{ grid-template-columns: repeat(4, 1fr); }
    }
    .letterBtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 12px 10px;
      border-radius: 14px;
      font-weight: 1000;
      cursor:pointer;
      text-align:center;
      user-select:none;
    }
    .letterBtn:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.24); }

    .rewardToast{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 99;
      max-width: 360px;
      border-radius: 16px;
      padding: 12px 12px;
      background: rgba(12, 19, 48, .92);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      display:none;
    }

    .footer{
      margin-top: 14px;
      padding: 14px 16px;
      border-top: 1px solid rgba(255,255,255,.12);
      color: rgba(234,240,255,.78); /* âœ… dimmer */
      font-weight: 800;
      font-size: 12px;
      text-align:center;
      background: rgba(0,0,0,.12);
    }

    /* Language picker (same style as home) */
    .langBar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .langLeft{ display:flex; flex-direction:column; gap:4px; }
    .langTitle{ font-weight: 950; }
    .langHint{ font-size:12px; font-weight:800; color: var(--muted); }
    select.langSelect{
      min-width: 240px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(15, 23, 51, .55);
      color: rgba(234,240,255,.86); /* âœ… dimmer */
      font-weight: 900;
      outline: none;
    }
    select.langSelect:focus{ outline: 3px solid rgba(183,195,255,.85); outline-offset: 2px; }

    button:focus, a:focus{ outline: 3px solid rgba(183,195,255,.85); outline-offset: 2px; }

    /* âœ… Eye-care panel UI (same as homepage) */
    .kb-panel{
      margin-top: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 12px;
    }
    .kb-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 10px;
    }
    .kb-row label{
      font-weight: 900;
      font-size: 13px;
      color: rgba(234,240,255,.84);
    }
    .kb-inline{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      min-width: 280px;
    }
    .kb-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      font-weight: 900;
      font-size: 12px;
      color: rgba(234,240,255,.84);
      white-space: nowrap;
    }
    .kb-toggle{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(234,240,255,.86);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 950;
      cursor:pointer;
    }
    .kb-toggle:hover{ background: rgba(255,255,255,.12); }

    input[type="range"]{
      width: 240px;
      accent-color: #b7c3ff;
    }
  </style>
</head>

<body>
  <!-- âœ… Blue-light overlay -->
  <div id="kbBlueOverlay" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="brandRow">
        <img class="logo" src="/logo.jpg" alt="Kido &amp; Babo Hub logo" />
        <div class="brand">
          <div class="title">Kido &amp; Babo Hub</div>
          <div class="sub">
            Designed for Homes â€¢ Schools â€¢ Religious Institutions â€¢ Parents â€¢ Children â€¢ Admins â€¢ All Devices Work â€¢ Voiced â€¢ Languages 100+ Online/Offline
          </div>
        </div>
      </div>

      <div class="nav" id="nav" aria-label="Top navigation">
        <button onclick="goPage('index.html')">ğŸ  Home</button>
        <button id="localMapBtn" onclick="openLocalMap()">ğŸ—ºï¸ Local Map</button>
        <button onclick="goPage('studentsdashboard.html')">ğŸ“Š Students Dashboard</button>
        <button onclick="goPage('help.html')">ğŸ†˜ Help</button>
        <button onclick="goPage('pay.html')">ğŸ Free Trial</button>
        <button onclick="goPage('tracker.html')">ğŸ“ Tracker</button>
        <button onclick="goPage('translator.html')">ğŸŒ Translator</button>
        <button onclick="goPage('readaloud.html')">ğŸ”Š Read Aloud</button>
        <button onclick="goPage('safetysongs.html')">ğŸ¶ Safety Songs</button>

        <button class="primary" id="edukidTopBtn" onclick="toggleEdukid()" aria-controls="edukidPanel" aria-expanded="false">
          <span>ğŸ“ EdukidGPT</span>
        </button>

        <!-- âœ… Global Eye-care button (like homepage) -->
        <button class="kb-toggle" id="kbEyeBtn" onclick="kbToggleEyePanel()" aria-expanded="false">ğŸ‘ï¸ Eye-Care</button>

        <button id="voiceToggle" onclick="toggleVoice()" title="Voice assistance on/off" aria-pressed="true">ğŸ”Š Voice: ON</button>
      </div>
    </header>

    <main>
      <section class="page">

        <!-- âœ… Eye-care panel (global) -->
        <div class="kb-panel" id="kbEyePanel" style="display:none" aria-label="Eye-care settings panel">
          <div class="kb-row" style="margin-top:0;">
            <div>
              <div style="font-weight:1000;">ğŸ‘ï¸ Eye-Care Settings</div>
              <div class="muted">Protect your eyes on all devices. Settings are saved automatically.</div>
            </div>
            <span class="kb-pill" id="kbAutoPill">Auto Night: ON</span>
          </div>

          <div class="kb-row">
            <label for="kbBrightness">ğŸ”† Brightness (dim)</label>
            <div class="kb-inline">
              <input id="kbBrightness" type="range" min="0.65" max="1" step="0.01" />
              <span class="kb-pill" id="kbBrightnessVal">100%</span>
            </div>
          </div>

          <div class="kb-row">
            <label for="kbBlue">ğŸŸ§ Blue-light filter (warm)</label>
            <div class="kb-inline">
              <input id="kbBlue" type="range" min="0" max="0.6" step="0.01" />
              <span class="kb-pill" id="kbBlueVal">0%</span>
            </div>
          </div>

          <div class="kb-row">
            <label for="kbTextScale">ğŸ” Text size</label>
            <div class="kb-inline">
              <input id="kbTextScale" type="range" min="0.9" max="1.25" step="0.01" />
              <span class="kb-pill" id="kbTextVal">100%</span>
            </div>
          </div>

          <div class="kb-row">
            <label>ğŸ«§ Soft contrast (reduce harsh white)</label>
            <div class="kb-inline">
              <button class="kb-toggle" onclick="kbToggleSoftContrast()" id="kbSoftBtn" aria-pressed="false">OFF</button>
              <span class="muted">Recommended for long use</span>
            </div>
          </div>

          <div class="kb-row">
            <label>ğŸŒ€ Reduce motion</label>
            <div class="kb-inline">
              <button class="kb-toggle" onclick="kbToggleReduceMotion()" id="kbMotionBtn" aria-pressed="false">OFF</button>
              <span class="muted">Stops animations</span>
            </div>
          </div>

          <div class="kb-row">
            <label>ğŸŒ™ Auto Night Mode (6pmâ€“6am)</label>
            <div class="kb-inline">
              <button class="kb-toggle" onclick="kbToggleAutoNight()" id="kbAutoBtn" aria-pressed="true">ON</button>
              <span class="muted">Auto protects eyes at night</span>
            </div>
          </div>

          <div class="kb-row">
            <button class="kb-toggle" onclick="kbResetEyeCare()">â™» Reset Eye-Care</button>
            <span class="muted">Back to safe defaults</span>
          </div>
        </div>

        <div class="grid">
          <div class="col-12">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <div>
                  <h1>ğŸŒ Translator + Language Learning</h1>
                  <p class="muted">Simple, fun, achievable learning: stories, alphabets, quizzes and rewards â€” saved on this device.</p>
                </div>
                <span class="pill" id="deviceModePill">Offline-friendly âœ…</span>
              </div>

              <!-- Language dropdown (applies to whole site via localStorage) -->
              <div class="langBar" aria-label="Language settings">
                <div class="langLeft">
                  <div class="langTitle">ğŸŒ Language for the whole site</div>
                  <div class="langHint" id="langStatus">Checking connectionâ€¦</div>
                </div>

                <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;">
                  <span class="pill" id="modePill">Mode: Offline</span>
                  <select class="langSelect" id="langSelect" aria-label="Select language"></select>
                </div>
              </div>

              <div class="kpiRow" aria-label="Learning progress">
                <div class="kpi" role="status" aria-live="polite">
                  <div>
                    <div class="big">â­ Stars: <span id="stars">0</span></div>
                    <div class="label">Earn by games & quizzes</div>
                  </div>
                </div>

                <div class="kpi" role="status" aria-live="polite">
                  <div>
                    <div class="big">ğŸ”¥ Streak: <span id="streak">0</span></div>
                    <div class="label">One win per day</div>
                  </div>
                </div>

                <div class="kpi" role="status" aria-live="polite">
                  <div>
                    <div class="big">ğŸ… Badges: <span id="badges">0</span></div>
                    <div class="label">Level up with stars</div>
                  </div>
                </div>
              </div>

              <div class="tabs" aria-label="Learning tabs">
                <button class="tabBtn active" id="tabTalk" type="button" onclick="showTab('talk')">ğŸ—£ï¸ Talking Partner</button>
                <button class="tabBtn" id="tabAlpha" type="button" onclick="showTab('alpha')">ğŸ”¤ Alphabets</button>
                <button class="tabBtn" id="tabWords" type="button" onclick="showTab('words')">ğŸ“˜ Words</button>
                <button class="tabBtn" id="tabQuiz" type="button" onclick="showTab('quiz')">ğŸ® Games + Quiz</button>
                <button class="tabBtn" id="tabStories" type="button" onclick="showTab('stories')">ğŸ“š Stories</button>
              </div>

              <div class="mini" style="margin-top:10px;">
                Tip: The â€œTalking Partnerâ€ speaks with your phone/computer voice. For Arabic: choose <b>Arabic</b> in the language dropdown then use the Alphabet and Stories tabs.
              </div>
            </div>
          </div>

          <!-- (YOUR EXISTING CONTENT CONTINUES UNCHANGED BELOW) -->

          <!-- TALKING PARTNER -->
          <div class="col-12" id="panelTalk">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2>ğŸ—£ï¸ Talking Partner</h2>
                <span class="pill">Kids + Parents</span>
              </div>
              <p class="muted">Simple â€œchat cardsâ€ you can practice. Tap <b>Speak</b> to hear it.</p>

              <div class="grid">
                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ‘§ Kid says</div>
                    <div class="mini" id="kidLine">Hello! What is your name?</div>
                    <div class="row" style="margin-top:10px;">
                      <button class="btn" type="button" onclick="speakKid($('#kidLine').textContent)">ğŸ”Š Speak</button>
                      <button class="btn yellow" type="button" onclick="nextTalk()">â¡ï¸ Next</button>
                    </div>
                  </div>
                </div>

                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ§‘â€ğŸ¼ Parent replies</div>
                    <div class="mini" id="parentLine">My name is â€¦</div>
                    <div class="row" style="margin-top:10px;">
                      <button class="btn" type="button" onclick="speakKid($('#parentLine').textContent)">ğŸ”Š Speak</button>
                      <button class="btn green" type="button" onclick="reward('Nice talking! +1 Star', 1)">â­ Reward</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row" style="margin-top:12px;">
                <select id="talkTopic" aria-label="Select topic" style="min-width:260px;flex:0;">
                  <option value="greetings">Greetings</option>
                  <option value="school">School</option>
                  <option value="home">Home</option>
                  <option value="food">Food</option>
                  <option value="help">Help & Safety</option>
                </select>
                <button class="btn primary" type="button" onclick="resetTalk()">ğŸ”„ Start topic</button>
                <button class="btn" type="button" onclick="speakKid('Repeat after me.')">ğŸ§ Repeat after me</button>
              </div>

              <div class="mini" style="margin-top:10px;">
                How to use: Kid reads the first line â†’ Parent answers â†’ Tap Reward. Do it 3 times a day for a streak!
              </div>
            </div>
          </div>

          <!-- ALPHABETS -->
          <div class="col-12" id="panelAlpha" style="display:none;">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2>ğŸ”¤ Alphabets & Letters</h2>
                <span class="pill" id="alphaPill">English</span>
              </div>

              <p class="muted">Tap a letter to hear it. Use <b>â€œFind the letterâ€</b> game for stars.</p>

              <div class="row">
                <select id="alphaLang" aria-label="Alphabet language" style="min-width:260px;flex:0;">
                  <option value="en">English (Aâ€“Z)</option>
                  <option value="sw">Kiswahili (Aâ€“Z)</option>
                  <option value="fr">French (Aâ€“Z)</option>
                  <option value="es">Spanish (Aâ€“Z)</option>
                  <option value="de">German (Aâ€“Z)</option>
                  <option value="it">Italian (Aâ€“Z)</option>
                  <option value="pt">Portuguese (Aâ€“Z)</option>
                  <option value="ru">Russian (Ğâ€“Ğ¯)</option>
                  <option value="ar">Arabic (Ø§â€“ÙŠ)</option>
                  <option value="hi">Hindi (à¤…â€“à¤¹)</option>
                  <option value="zh">Chinese (Pinyin Aâ€“Z)</option>
                </select>

                <button class="btn primary" type="button" onclick="buildAlphabet()">âœ… Load</button>
                <button class="btn yellow" type="button" onclick="startFindLetter()">ğŸ¯ Find the letter</button>
                <button class="btn" type="button" onclick="stopFindLetter()">ğŸ›‘ Stop</button>
              </div>

              <div class="box" style="margin-top:10px;">
                <div style="font-weight:1000;">ğŸ¯ Game: Find</div>
                <div class="mini" id="findPrompt">Tap â€œFind the letterâ€ to start.</div>
              </div>

              <div class="letterGrid" id="letters"></div>

              <div class="mini" style="margin-top:10px;">
                Arabic tip: Letters can change shape in words. Here we practice the main letter names first (achievable offline).
              </div>
            </div>
          </div>

          <!-- WORDS -->
          <div class="col-12" id="panelWords" style="display:none;">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2>ğŸ“˜ Learn Words (Saved on this device)</h2>
                <span class="pill">Offline</span>
              </div>

              <p class="muted">Add simple words + meanings. Then use games in the Quiz tab.</p>

              <div class="row" style="margin-top:10px;">
                <input id="wordText" placeholder="Word (e.g., apple)" spellcheck="true"/>
                <input id="wordMeaning" placeholder="Meaning / translation (simple)" spellcheck="true"/>
              </div>

              <div class="row" style="margin-top:10px;">
                <button class="btn green" id="btnSaveWord" type="button">ğŸ’¾ Save</button>
                <button class="btn yellow" id="btnRandomWord" type="button">ğŸ² Random</button>
                <button class="btn" id="btnSpeakWord" type="button">ğŸ”Š Speak</button>
                <button class="btn danger" id="btnClearWords" type="button">ğŸ§¹ Clear (device)</button>
              </div>

              <div class="mini">Tip: Keep meanings short: â€œapple = ØªÙØ§Ø­Ø© / tuffÄá¸¥aâ€.</div>
              <div style="margin-top:10px;" class="box" id="wordsBox">No saved words yet.</div>
            </div>
          </div>

          <!-- QUIZ + GAMES -->
          <div class="col-12" id="panelQuiz" style="display:none;">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2>ğŸ® Games + Quiz</h2>
                <span class="pill">Rewards</span>
              </div>

              <div class="grid">
                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ´ Flashcards</div>
                    <div class="mini" id="flashWord">Add words first (Words tab).</div>
                    <div class="row" style="margin-top:10px;">
                      <button class="btn yellow" type="button" onclick="flashNext()">â¡ï¸ Next</button>
                      <button class="btn" type="button" onclick="flashSpeak()">ğŸ”Š Speak</button>
                      <button class="btn green" type="button" onclick="flashIknow()">âœ… I know (+1)</button>
                    </div>
                  </div>
                </div>

                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ§  Quick Quiz</div>
                    <div class="mini">Pick a saved word. Say the meaning. Then check.</div>

                    <div class="row" style="margin-top:10px;">
                      <select id="quizPick" aria-label="Pick a word"></select>
                      <button class="btn" id="btnShowAnswer" type="button">âœ… Show answer</button>
                      <button class="btn green" id="btnGotIt" type="button">ğŸ† Got it (+2)</button>
                    </div>

                    <div style="margin-top:10px;" class="mini" id="quizBox">Add words first to start quiz.</div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ§© Match Game (Easy)</div>
                    <div class="mini">Tap two cards to match: word â†” meaning. (Simple offline game)</div>
                    <div class="row" style="margin-top:10px;">
                      <button class="btn primary" type="button" onclick="startMatchGame()">â–¶ï¸ Start match game</button>
                      <button class="btn" type="button" onclick="resetMatchGame()">ğŸ”„ Reset</button>
                    </div>
                    <div class="grid" style="margin-top:10px;" id="matchGrid"></div>
                    <div class="mini" id="matchNote" style="margin-top:8px;"></div>
                  </div>
                </div>
              </div>

              <div class="mini" style="margin-top:10px;">
                Achievable offline = small wins. Want â€œbetter than Duolingoâ€ feeling? Focus on: streaks, rewards, voice, and simple games that always work.
              </div>
            </div>
          </div>

          <!-- STORIES -->
          <div class="col-12" id="panelStories" style="display:none;">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2>ğŸ“š Mini Stories (Read Aloud)</h2>
                <span class="pill">Practice</span>
              </div>

              <p class="muted">Short, kid-friendly stories with learning words. Tap â€œRead to meâ€.</p>

              <div class="row" style="margin-top:10px;">
                <select id="storyLang" aria-label="Story language" style="min-width:260px;flex:0;">
                  <option value="en">English</option>
                  <option value="sw">Kiswahili</option>
                  <option value="fr">FranÃ§ais</option>
                  <option value="es">EspaÃ±ol</option>
                  <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</option>
                </select>
                <select id="storyPick" aria-label="Pick a story" style="min-width:260px;flex:0;"></select>
                <button class="btn primary" type="button" onclick="loadStory()">âœ… Load story</button>
                <button class="btn" type="button" onclick="readStory()">ğŸ”Š Read to me</button>
                <button class="btn yellow" type="button" onclick="reward('Story finished! +3 Stars', 3)">ğŸ… Finish (+3)</button>
              </div>

              <div class="box" style="margin-top:10px;">
                <div style="font-weight:1000;" id="storyTitle">Choose a story</div>
                <div class="mini" id="storyBody" style="margin-top:6px;">Pick a story then tap â€œLoad storyâ€.</div>
              </div>

              <div class="grid" style="margin-top:12px;">
                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ§  Learn words from this story</div>
                    <div class="mini">Tap to save words into your Words list.</div>
                    <div class="row" style="margin-top:10px;" id="storyWords"></div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="box">
                    <div style="font-weight:1000;">ğŸ¯ Micro-quiz</div>
                    <div class="mini" id="storyQuizQ">Load a story to begin.</div>
                    <div class="row" style="margin-top:10px;" id="storyQuizOpts"></div>
                    <div class="mini" id="storyQuizNote" style="margin-top:8px;"></div>
                  </div>
                </div>
              </div>

              <div class="mini" style="margin-top:10px;">
                Arabic beginner tip: Listen â†’ repeat â†’ tap a word to save it â†’ practice in Flashcards.
              </div>
            </div>
          </div>

          <!-- EDUKID PANEL -->
          <div class="col-12">
            <div id="edukidPanel" class="card" style="display:none;text-align:left;">
              <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
                <div style="font-weight:900;font-size:16px;">ğŸ‘§ğŸ§’ EdukidGPT (Offline)</div>
                <div class="muted" style="font-size:12px;">Safe mode: school topics âœ…</div>
              </div>
              <div class="mini" style="margin-top:10px;">
                (Keep your existing EdukidGPT content here.)
              </div>
            </div>
          </div>
        </div>

        <div class="footer">
          kidobabohub.web.app â€¢ Est. 2026 â€¢ Â© Copyright
        </div>
      </section>
    </main>
  </div>

  <div class="rewardToast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // =============================
    // Helpers
    // =============================
    const $ = (id)=>document.getElementById(id);

    function escapeHtml(str){
      return String(str||"").replace(/[&<>"']/g, (m)=>( {
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m] ));
    }

    // =============================
    // 1) Multi-page navigation
    // =============================
    function goPage(file){
      speakKid("Opening " + prettyName(file) + ".");
      setTimeout(() => { window.location.href = file; }, 120);
    }
    function prettyName(file){
      const map = {
        "index.html": "Home",
        "studentsdashboard.html": "Students Dashboard",
        "help.html": "Help",
        "pay.html": "Free Trial",
        "tracker.html": "Tracker",
        "translator.html": "Translator",
        "readaloud.html": "Read Aloud",
        "safetysongs.html": "Safety Songs",
        "map.html": "Local Map"
      };
      return map[file] || "page";
    }

    // =============================
    // 2) Voice (same style as homepage)
    // =============================
    let voiceOn = true;
    let kidVoice = null;

    function loadVoiceSetting(){
      const saved = localStorage.getItem("kb_voiceOn");
      voiceOn = (saved === null) ? true : (saved === "1");
      updateVoiceButton();
    }
    function updateVoiceButton(){
      const btn = $("voiceToggle");
      if(!btn) return;
      btn.textContent = voiceOn ? "ğŸ”Š Voice: ON" : "ğŸ”‡ Voice: OFF";
      btn.setAttribute("aria-pressed", voiceOn ? "true" : "false");
    }
    function toggleVoice(){
      voiceOn = !voiceOn;
      localStorage.setItem("kb_voiceOn", voiceOn ? "1" : "0");
      updateVoiceButton();
      speakKid(voiceOn ? "Voice is on." : "Voice is off.");
    }

    function pickKidVoice(){
      const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      if(!voices || !voices.length) return null;

      const preferred = voices
        .filter(v => /en|sw|fr|es|ar|pt|hi|zh|de|it|ru/i.test(v.lang || ""))
        .sort((a,b) => scoreVoice(b) - scoreVoice(a));

      return preferred[0] || voices[0] || null;

      function scoreVoice(v){
        const n = (v.name || "").toLowerCase();
        let s = 0;
        if(n.includes("natural")) s += 6;
        if(n.includes("neural")) s += 6;
        if(n.includes("google")) s += 5;
        if(n.includes("microsoft")) s += 4;
        if(n.includes("aria")) s += 3;
        if(n.includes("jenny")) s += 3;
        if(n.includes("zira")) s += 2;
        if(n.includes("robot")) s -= 10;
        return s;
      }
    }

    function initVoices(){
      kidVoice = pickKidVoice();
      if(!kidVoice && 'speechSynthesis' in window){
        speechSynthesis.onvoiceschanged = () => { kidVoice = pickKidVoice(); };
      }
    }

    function speakKid(text){
      try{
        if(!voiceOn) return;
        if(!('speechSynthesis' in window)) return;
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);

        // Use selected site language for voice when possible
        u.lang = localStorage.getItem("kb_siteVoiceLang") || "en";

        u.rate = 0.98;
        u.pitch = 1.25;
        if(kidVoice) u.voice = kidVoice;
        speechSynthesis.speak(u);
      }catch(e){}
    }

    // =============================
    // âœ… 2.5) GLOBAL EYE-CARE (same as homepage)
    // =============================
    const EC = {
      LS: "kb_eyeCare_v1",
      defaults: {
        brightness: 0.90,
        blue: 0.12,
        textScale: 1.00,
        softContrast: true,
        reduceMotion: false,
        autoNight: true
      }
    };

    function kbReadEC(){
      try{
        const raw = localStorage.getItem(EC.LS);
        const obj = raw ? JSON.parse(raw) : {};
        return { ...EC.defaults, ...(obj||{}) };
      }catch(_){
        return { ...EC.defaults };
      }
    }
    function kbWriteEC(v){
      localStorage.setItem(EC.LS, JSON.stringify(v||{}));
    }

    function kbApplyEC(state){
      if(state.autoNight){
        const h = new Date().getHours();
        const isNight = (h >= 18 || h < 6);
        const nightBrightness = Math.min(state.brightness, 0.85);
        const nightBlue = Math.max(state.blue, 0.18);

        document.documentElement.style.setProperty("--kbBrightness", String(isNight ? nightBrightness : state.brightness));
        document.documentElement.style.setProperty("--kbBlue", String(isNight ? nightBlue : state.blue));
        const ap = $("kbAutoPill");
        if(ap) ap.textContent = "Auto Night: ON";
      } else {
        document.documentElement.style.setProperty("--kbBrightness", String(state.brightness));
        document.documentElement.style.setProperty("--kbBlue", String(state.blue));
        const ap = $("kbAutoPill");
        if(ap) ap.textContent = "Auto Night: OFF";
      }

      document.documentElement.style.setProperty("--kbTextScale", String(state.textScale));

      document.documentElement.classList.toggle("kb-soft", !!state.softContrast);
      document.documentElement.classList.toggle("kb-reduce-motion", !!state.reduceMotion);

      const b = $("kbBrightness");
      const bl = $("kbBlue");
      const t = $("kbTextScale");

      if(b) b.value = String(state.brightness);
      if(bl) bl.value = String(state.blue);
      if(t) t.value = String(state.textScale);

      const bV = $("kbBrightnessVal");
      const blV = $("kbBlueVal");
      const tV = $("kbTextVal");

      if(bV) bV.textContent = Math.round(parseFloat(state.brightness) * 100) + "%";
      if(blV) blV.textContent = Math.round(parseFloat(state.blue) * 100) + "%";
      if(tV) tV.textContent = Math.round(parseFloat(state.textScale) * 100) + "%";

      const softBtn = $("kbSoftBtn");
      const motionBtn = $("kbMotionBtn");
      const autoBtn = $("kbAutoBtn");

      if(softBtn){
        softBtn.textContent = state.softContrast ? "ON" : "OFF";
        softBtn.setAttribute("aria-pressed", state.softContrast ? "true" : "false");
      }
      if(motionBtn){
        motionBtn.textContent = state.reduceMotion ? "ON" : "OFF";
        motionBtn.setAttribute("aria-pressed", state.reduceMotion ? "true" : "false");
      }
      if(autoBtn){
        autoBtn.textContent = state.autoNight ? "ON" : "OFF";
        autoBtn.setAttribute("aria-pressed", state.autoNight ? "true" : "false");
      }
    }

    function kbToggleEyePanel(){
      const p = $("kbEyePanel");
      const btn = $("kbEyeBtn");
      if(!p || !btn) return;
      const open = (p.style.display === "none" || !p.style.display);
      p.style.display = open ? "block" : "none";
      btn.setAttribute("aria-expanded", open ? "true" : "false");
      if(open) speakKid("Eye care settings opened.");
    }
    window.kbToggleEyePanel = kbToggleEyePanel;

    function kbBindEyeCare(){
      let st = kbReadEC();
      kbApplyEC(st);

      const brightness = $("kbBrightness");
      const blue = $("kbBlue");
      const text = $("kbTextScale");

      if(brightness){
        brightness.addEventListener("input", ()=>{
          st = kbReadEC();
          st.brightness = parseFloat(brightness.value);
          kbWriteEC(st);
          kbApplyEC(st);
        });
      }
      if(blue){
        blue.addEventListener("input", ()=>{
          st = kbReadEC();
          st.blue = parseFloat(blue.value);
          kbWriteEC(st);
          kbApplyEC(st);
        });
      }
      if(text){
        text.addEventListener("input", ()=>{
          st = kbReadEC();
          st.textScale = parseFloat(text.value);
          kbWriteEC(st);
          kbApplyEC(st);
        });
      }
    }

    window.kbToggleSoftContrast = function(){
      const st = kbReadEC();
      st.softContrast = !st.softContrast;
      kbWriteEC(st);
      kbApplyEC(st);
      speakKid(st.softContrast ? "Soft contrast on." : "Soft contrast off.");
    };

    window.kbToggleReduceMotion = function(){
      const st = kbReadEC();
      st.reduceMotion = !st.reduceMotion;
      kbWriteEC(st);
      kbApplyEC(st);
      speakKid(st.reduceMotion ? "Reduce motion on." : "Reduce motion off.");
    };

    window.kbToggleAutoNight = function(){
      const st = kbReadEC();
      st.autoNight = !st.autoNight;
      kbWriteEC(st);
      kbApplyEC(st);
      speakKid(st.autoNight ? "Auto night mode on." : "Auto night mode off.");
    };

    window.kbResetEyeCare = function(){
      kbWriteEC({ ...EC.defaults });
      const st = kbReadEC();
      kbApplyEC(st);
      speakKid("Eye care reset.");
    };

    // Re-apply every minute so Auto Night stays correct
    setInterval(()=>{
      kbApplyEC(kbReadEC());
    }, 60 * 1000);

    // =============================
    // 3) Edukid toggle
    // =============================
    function toggleEdukid(){
      const p = $("edukidPanel");
      const btn = $("edukidTopBtn");
      if(!p || !btn) return;

      const opening = (p.style.display === "none" || !p.style.display);
      p.style.display = opening ? "block" : "none";
      btn.classList.toggle("is-open", opening);
      btn.setAttribute("aria-expanded", opening ? "true" : "false");

      speakKid(opening ? "Edukid GPT is open." : "Edukid GPT is closed.");
      if(opening){
        setTimeout(() => p.scrollIntoView({behavior:"smooth", block:"start"}), 200);
      }
    }

    // =============================
    // 4) Local Map
    // =============================
    function openLocalMap(){
      speakKid("Opening local map.");
      setTimeout(() => { window.location.href = "tracker.html"; }, 120);
    }

    // =============================
    // 5) Language dropdown (site-wide, same as home)
    // =============================
    const OFFLINE_LANGS = [
      { code:"en", name:"English (Offline)" },
      { code:"sw", name:"Kiswahili (Offline)" },
      { code:"fr", name:"FranÃ§ais (Offline)" },
      { code:"es", name:"EspaÃ±ol (Offline)" },
      { code:"ar", name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Offline)" },
      { code:"pt", name:"PortuguÃªs (Offline)" },
      { code:"hi", name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Offline)" },
      { code:"zh", name:"ä¸­æ–‡ (Offline)" },
      { code:"de", name:"Deutsch (Offline)" },
      { code:"it", name:"Italiano (Offline)" },
      { code:"ru", name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Offline)" }
    ];

    const ONLINE_LANGS = [
      { code:"auto", name:"Auto Detect (Online)" },
      { code:"en", name:"English" },
      { code:"sw", name:"Kiswahili" },
      { code:"fr", name:"FranÃ§ais" },
      { code:"es", name:"EspaÃ±ol" },
      { code:"ar", name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
      { code:"pt", name:"PortuguÃªs" },
      { code:"hi", name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€" },
      { code:"zh", name:"ä¸­æ–‡" },
      { code:"de", name:"Deutsch" },
      { code:"it", name:"Italiano" },
      { code:"ru", name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹" },
      { code:"tr", name:"TÃ¼rkÃ§e" },
      { code:"nl", name:"Nederlands" },
      { code:"pl", name:"Polski" },
      { code:"uk", name:"Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°" },
      { code:"ja", name:"æ—¥æœ¬èª" },
      { code:"ko", name:"í•œêµ­ì–´" },
      { code:"am", name:"áŠ áˆ›áˆ­áŠ›" },
      { code:"ha", name:"Hausa" },
      { code:"yo", name:"YorÃ¹bÃ¡" },
      { code:"ig", name:"Igbo" },
      { code:"rw", name:"Kinyarwanda" },
      { code:"lg", name:"Luganda" },
      { code:"so", name:"Soomaali" },
      { code:"om", name:"Afaan Oromoo" },
      { code:"zu", name:"isiZulu" },
      { code:"xh", name:"isiXhosa" }
    ];

    function isOnlineNow(){ return navigator.onLine === true; }

    function buildLanguageDropdown(){
      const sel = $("langSelect");
      const status = $("langStatus");
      const pill = $("modePill");
      if(!sel || !status || !pill) return;

      const online = isOnlineNow();

      status.textContent = online
        ? "Online: all languages available (100+). Your choice applies to the whole site."
        : "Offline: 11 languages available. Your choice applies to the whole site.";
      pill.textContent = online ? "Mode: Online" : "Mode: Offline";

      sel.innerHTML = "";

      const og1 = document.createElement("optgroup");
      og1.label = "Offline (11)";
      OFFLINE_LANGS.forEach(l => {
        const opt = document.createElement("option");
        opt.value = "offline:" + l.code;
        opt.textContent = l.name;
        og1.appendChild(opt);
      });
      sel.appendChild(og1);

      if(online){
        const og2 = document.createElement("optgroup");
        og2.label = "Online (All)";
        ONLINE_LANGS.forEach(l => {
          const opt = document.createElement("option");
          opt.value = "online:" + l.code;
          opt.textContent = l.name + " (Online)";
          og2.appendChild(opt);
        });
        sel.appendChild(og2);
      }

      const saved = localStorage.getItem("kb_siteLangModeCode");
      if(saved){
        const ok = [...sel.options].some(o => o.value === saved);
        sel.value = ok ? saved : "offline:en";
      }else{
        sel.value = "offline:en";
      }

      applySiteLanguage(sel.value);

      sel.onchange = () => {
        localStorage.setItem("kb_siteLangModeCode", sel.value);
        applySiteLanguage(sel.value);
      };
    }

    function applySiteLanguage(modeCode){
      const parts = (modeCode || "offline:en").split(":");
      const mode = parts[0] || "offline";
      const code = parts[1] || "en";

      localStorage.setItem("kb_siteLangMode", mode);
      localStorage.setItem("kb_siteLangCode", code);

      const voiceCode = (code === "auto") ? "en" : code;
      localStorage.setItem("kb_siteVoiceLang", voiceCode);
      document.documentElement.lang = voiceCode;

      speakKid(mode === "offline"
        ? ("Site language set to " + code + " offline.")
        : ("Site language set to " + (code === "auto" ? "auto detect" : code) + " online.")
      );
    }

    // =============================
    // Tabs
    // =============================
    function showTab(key){
      const panels = {
        talk: $("panelTalk"),
        alpha: $("panelAlpha"),
        words: $("panelWords"),
        quiz: $("panelQuiz"),
        stories: $("panelStories")
      };
      Object.keys(panels).forEach(k => panels[k].style.display = (k===key ? "block" : "none"));

      const btns = {
        talk: $("tabTalk"),
        alpha: $("tabAlpha"),
        words: $("tabWords"),
        quiz: $("tabQuiz"),
        stories: $("tabStories")
      };
      Object.keys(btns).forEach(k => btns[k].classList.toggle("active", k===key));

      speakKid("Opening " + ({
        talk:"Talking partner",
        alpha:"alphabets",
        words:"words",
        quiz:"games and quiz",
        stories:"stories"
      }[key] || "tab") + ".");
    }

    // =============================
    // Rewards + Stats
    // =============================
    const LS_WORDS = "kb_words_v2";
    const LS_STARS = "kb_stars_v2";
    const LS_STREAK = "kb_streak_v2";
    const LS_BADGES = "kb_badges_v2";
    const LS_LAST_WIN = "kb_lastWinDate_v2"; // YYYY-MM-DD

    function todayKey(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }

    function getIntLS(key, fallback=0){
      const n = parseInt(localStorage.getItem(key) || "", 10);
      return Number.isFinite(n) ? n : fallback;
    }

    function setStatsUI(){
      $("stars").textContent = String(getIntLS(LS_STARS,0));
      $("streak").textContent = String(getIntLS(LS_STREAK,0));
      $("badges").textContent = String(getIntLS(LS_BADGES,0));
    }

    function maybeBadge(){
      const stars = getIntLS(LS_STARS,0);
      const need = [10, 25, 50, 100];
      const badges = getIntLS(LS_BADGES,0);
      if(badges < need.length && stars >= need[badges]){
        localStorage.setItem(LS_BADGES, String(badges + 1));
        toast(`ğŸ… Badge unlocked! Badge #${badges+1}`, 1400);
        speakKid("Badge unlocked.");
      }
    }

    function reward(msg, addStars){
      const curStars = getIntLS(LS_STARS,0) + (addStars||0);
      localStorage.setItem(LS_STARS, String(curStars));

      // streak: only increase once per day
      const last = localStorage.getItem(LS_LAST_WIN) || "";
      const t = todayKey();
      if(last !== t){
        const newStreak = getIntLS(LS_STREAK,0) + 1;
        localStorage.setItem(LS_STREAK, String(newStreak));
        localStorage.setItem(LS_LAST_WIN, t);
      }

      setStatsUI();
      maybeBadge();
      toast(msg || "Nice! +Stars", 1400);
      speakKid(msg || "Great job.");
    }

    function toast(msg, ms){
      const el = $("toast");
      el.innerHTML = `<div style="font-weight:1000;">${escapeHtml(msg)}</div><div class="mini">Stars and streak saved on this device.</div>`;
      el.style.display = "block";
      setTimeout(()=>{ el.style.display="none"; }, ms||1200);
    }

    // =============================
    // WORDS storage
    // =============================
    function loadWords(){
      try{
        const arr = JSON.parse(localStorage.getItem(LS_WORDS) || "[]");
        return Array.isArray(arr) ? arr : [];
      }catch(_){ return []; }
    }
    function saveWords(arr){
      localStorage.setItem(LS_WORDS, JSON.stringify(arr.slice(0, 400)));
    }

    function renderWords(){
      const arr = loadWords();
      if(!arr.length){
        $("wordsBox").textContent = "No saved words yet.";
        $("quizPick").innerHTML = "";
        $("quizBox").textContent = "Add words first to start quiz.";
        $("flashWord").textContent = "Add words first (Words tab).";
        return;
      }

      $("wordsBox").innerHTML = arr.slice(-40).reverse().map(w=>{
        return `<div>â€¢ <b>${escapeHtml(w.word)}</b> â€” ${escapeHtml(w.meaning)}</div>`;
      }).join("");

      $("quizPick").innerHTML = arr.map((w,i)=>{
        return `<option value="${i}">${escapeHtml(w.word)}</option>`;
      }).join("");

      $("quizBox").textContent = "Pick a word, say the meaning, then show answer.";
      updateFlashCard();
    }

    // =============================
    // WORD actions
    // =============================
    $("btnSaveWord").onclick = ()=>{
      const word = ($("wordText").value||"").trim();
      const meaning = ($("wordMeaning").value||"").trim();
      if(word.length < 1 || meaning.length < 1){
        toast("Type a word and meaning.", 1100);
        speakKid("Please type a word and meaning.");
        return;
      }

      const arr = loadWords();
      const exists = arr.some(x=>x.word.toLowerCase()===word.toLowerCase());
      if(!exists){
        arr.push({ word: word.slice(0,50), meaning: meaning.slice(0,80), ts: Date.now() });
        saveWords(arr);
        reward("Saved! +1 Star", 1);
      }else{
        toast("That word already exists.", 1100);
        speakKid("That word already exists.");
      }

      $("wordText").value = "";
      $("wordMeaning").value = "";
      renderWords();
    };

    $("btnRandomWord").onclick = ()=>{
      const arr = loadWords();
      if(!arr.length) return;
      const pick = arr[Math.floor(Math.random()*arr.length)];
      $("wordText").value = pick.word;
      $("wordMeaning").value = pick.meaning;
      speakKid(pick.word);
    };

    $("btnSpeakWord").onclick = ()=>{
      const w = ($("wordText").value||"").trim();
      if(w) speakKid(w);
    };

    $("btnClearWords").onclick = ()=>{
      localStorage.removeItem(LS_WORDS);
      renderWords();
      toast("Cleared words on this device.", 1300);
      speakKid("Cleared.");
    };

    // =============================
    // QUIZ actions
    // =============================
    $("btnShowAnswer").onclick = ()=>{
      const arr = loadWords();
      const i = parseInt(($("quizPick").value||"0"),10);
      const pick = arr[i];
      if(!pick) return;
      $("quizBox").innerHTML = `<div><b>${escapeHtml(pick.word)}</b> means: <b>${escapeHtml(pick.meaning)}</b></div>`;
      speakKid(pick.meaning);
    };

    $("btnGotIt").onclick = ()=>{
      reward("Great! +2 Stars", 2);
    };

    // =============================
    // Flashcards
    // =============================
    let flashIndex = 0;

    function updateFlashCard(){
      const arr = loadWords();
      if(!arr.length){ $("flashWord").textContent = "Add words first (Words tab)."; return; }
      if(flashIndex >= arr.length) flashIndex = 0;
      const w = arr[flashIndex];
      $("flashWord").innerHTML = `<div style="font-weight:1000;font-size:16px;">${escapeHtml(w.word)}</div><div class="mini">Try to say: ${escapeHtml(w.meaning)}</div>`;
    }

    function flashNext(){
      const arr = loadWords();
      if(!arr.length) return;
      flashIndex = (flashIndex + 1) % arr.length;
      updateFlashCard();
      speakKid(arr[flashIndex].word);
    }
    function flashSpeak(){
      const arr = loadWords();
      if(!arr.length) return;
      speakKid(arr[flashIndex].word + ". " + arr[flashIndex].meaning);
    }
    function flashIknow(){
      const arr = loadWords();
      if(!arr.length) return;
      reward("Nice! +1 Star", 1);
      flashNext();
    }

    // =============================
    // Match game
    // =============================
    let matchState = { cards:[], picked:[], locked:false, matched:0 };

    function startMatchGame(){
      const arr = loadWords();
      if(arr.length < 3){
        $("matchNote").textContent = "Add at least 3 words to start match game.";
        speakKid("Add at least three words to start the match game.");
        return;
      }

      const sample = shuffle(arr.slice()).slice(0, 6);
      const cards = [];
      sample.forEach((w, idx)=>{
        cards.push({ id:`w${idx}`, key: idx, type:"word", text: w.word });
        cards.push({ id:`m${idx}`, key: idx, type:"meaning", text: w.meaning });
      });

      matchState = { cards: shuffle(cards), picked:[], locked:false, matched:0 };
      renderMatchGrid();
      $("matchNote").textContent = "Tap a word card, then tap its meaning card.";
      speakKid("Match game started.");
    }

    function resetMatchGame(){
      $("matchGrid").innerHTML = "";
      $("matchNote").textContent = "";
      matchState = { cards:[], picked:[], locked:false, matched:0 };
    }

    function renderMatchGrid(){
      const g = $("matchGrid");
      g.innerHTML = "";

      matchState.cards.forEach((c, idx)=>{
        const b = document.createElement("button");
        b.type = "button";
        b.className = "btn";
        b.style.width = "100%";
        b.style.justifyContent = "flex-start";
        b.style.borderRadius = "16px";
        b.style.padding = "12px";
        b.style.background = "rgba(255,255,255,.06)";
        b.style.borderColor = "rgba(255,255,255,.14)";
        b.dataset.idx = String(idx);

        const isMatched = c.matched === true;
        const isPicked = matchState.picked.includes(idx);

        b.innerHTML = isMatched
          ? `âœ… <b>${escapeHtml(c.text)}</b>`
          : (isPicked ? `ğŸŸ¨ <b>${escapeHtml(c.text)}</b>` : `â“ <b>${escapeHtml(c.type === "word" ? "Word" : "Meaning")}</b>`);

        b.disabled = isMatched || matchState.locked;

        b.onclick = ()=> pickMatch(idx);
        g.appendChild(b);
      });
    }

    function pickMatch(idx){
      if(matchState.locked) return;
      const c = matchState.cards[idx];
      if(c.matched) return;

      matchState.picked.push(idx);
      renderMatchGrid();

      if(matchState.picked.length === 1){
        speakKid(c.text);
        return;
      }

      if(matchState.picked.length === 2){
        const a = matchState.cards[matchState.picked[0]];
        const b = matchState.cards[matchState.picked[1]];

        matchState.locked = true;

        const ok = (a.key === b.key) && (a.type !== b.type);
        setTimeout(()=>{
          if(ok){
            a.matched = true; b.matched = true;
            matchState.matched += 1;
            reward("Matched! +1 Star", 1);
            speakKid("Correct match.");
          }else{
            speakKid("Try again.");
          }
          matchState.picked = [];
          matchState.locked = false;
          renderMatchGrid();

          const totalPairs = matchState.cards.length / 2;
          if(matchState.matched === totalPairs){
            reward("Match game completed! +4 Stars", 4);
            $("matchNote").textContent = "ğŸ‰ Completed! Tap Start again for new cards.";
          }
        }, 500);
      }
    }

    function shuffle(arr){
      for(let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // =============================
    // Talking partner
    // =============================
    const TALK = {
      greetings: [
        ["Hello! What is your name?", "My name is â€¦"],
        ["How are you today?", "I am fine. Thank you!"],
        ["Nice to meet you!", "Nice to meet you too!"]
      ],
      school: [
        ["What do you learn at school?", "I learn letters and numbers."],
        ["What is your favorite subject?", "My favorite subject is â€¦"],
        ["Can you read this word?", "Yes! I can read it."]
      ],
      home: [
        ["Who is at home with you?", "My family is at home."],
        ["What do you like to do at home?", "I like to read and play."],
        ["Can you help me?", "Yes, I can help."]
      ],
      food: [
        ["What food do you like?", "I like â€¦"],
        ["Are you hungry?", "Yes, a little."],
        ["Thank you for the food!", "You are welcome!"]
      ],
      help: [
        ["I need help, please.", "Okay. I will help you."],
        ["Where is the teacher?", "The teacher is there."],
        ["I feel unsafe.", "Let us go to a safe place."]
      ]
    };
    let talkIndex = 0;

    function resetTalk(){
      talkIndex = 0;
      applyTalk();
      reward("Topic started! +1 Star", 1);
    }

    function nextTalk(){
      const topic = $("talkTopic").value || "greetings";
      const list = TALK[topic] || TALK.greetings;
      talkIndex = (talkIndex + 1) % list.length;
      applyTalk();
    }

    function applyTalk(){
      const topic = $("talkTopic").value || "greetings";
      const list = TALK[topic] || TALK.greetings;
      const pair = list[talkIndex] || list[0];
      $("kidLine").textContent = pair[0];
      $("parentLine").textContent = pair[1];
      speakKid(pair[0]);
    }

    // =============================
    // Alphabets
    // =============================
    let findTarget = null;
    let findActive = false;

    const ALPHABETS = {
      en: { name:"English", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") },
      sw: { name:"Kiswahili", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") },
      fr: { name:"French", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") },
      es: { name:"Spanish", letters: "A B C D E F G H I J K L M N Ã‘ O P Q R S T U V W X Y Z".split(" ") },
      de: { name:"German", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") },
      it: { name:"Italian", letters: "A B C D E F G H I L M N O P Q R S T U V Z".split(" ") },
      pt: { name:"Portuguese", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") },
      ru: { name:"Russian", letters: "Ğ Ğ‘ Ğ’ Ğ“ Ğ” Ğ• Ğ Ğ– Ğ— Ğ˜ Ğ™ Ğš Ğ› Ğœ Ğ Ğ ĞŸ Ğ  Ğ¡ Ğ¢ Ğ£ Ğ¤ Ğ¥ Ğ¦ Ğ§ Ğ¨ Ğ© Ğª Ğ« Ğ¬ Ğ­ Ğ® Ğ¯".split(" ") },
      ar: { name:"Arabic", letters: "Ø§ Ø¨ Øª Ø« Ø¬ Ø­ Ø® Ø¯ Ø° Ø± Ø² Ø³ Ø´ Øµ Ø¶ Ø· Ø¸ Ø¹ Øº Ù Ù‚ Ùƒ Ù„ Ù… Ù† Ù‡ Ùˆ ÙŠ".split(" ") },
      hi: { name:"Hindi", letters: "à¤… à¤† à¤‡ à¤ˆ à¤‰ à¤Š à¤ à¤ à¤“ à¤” à¤• à¤– à¤— à¤˜ à¤š à¤› à¤œ à¤ à¤Ÿ à¤  à¤¡ à¤¢ à¤¤ à¤¥ à¤¦ à¤§ à¤¨ à¤ª à¤« à¤¬ à¤­ à¤® à¤¯ à¤° à¤² à¤µ à¤¶ à¤· à¤¸ à¤¹".split(" ") },
      zh: { name:"Chinese (Pinyin)", letters: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ") }
    };

    function buildAlphabet(){
      const code = $("alphaLang").value || "en";
      const cfg = ALPHABETS[code] || ALPHABETS.en;
      $("alphaPill").textContent = cfg.name;
      const box = $("letters");
      box.innerHTML = "";

      cfg.letters.forEach(ch=>{
        const b = document.createElement("button");
        b.type = "button";
        b.className = "letterBtn";
        b.textContent = ch;

        b.onclick = ()=>{
          speakKid(ch);
          if(findActive && findTarget){
            if(ch === findTarget){
              reward("Correct letter! +1 Star", 1);
              startFindLetter();
            }else{
              toast("Try again ğŸ™‚", 900);
              speakKid("Try again.");
            }
          }
        };

        box.appendChild(b);
      });

      stopFindLetter();
      toast("Alphabet loaded.", 1000);
      speakKid(cfg.name + " alphabet loaded.");
    }

    function startFindLetter(){
      const code = $("alphaLang").value || "en";
      const cfg = ALPHABETS[code] || ALPHABETS.en;
      findTarget = cfg.letters[Math.floor(Math.random() * cfg.letters.length)];
      findActive = true;
      $("findPrompt").textContent = `Find: ${findTarget}`;
      speakKid("Find " + findTarget);
    }

    function stopFindLetter(){
      findActive = false;
      findTarget = null;
      $("findPrompt").textContent = "Tap â€œFind the letterâ€ to start.";
    }

    // =============================
    // Stories
    // =============================
    const STORIES = { /* (UNCHANGED - keep your existing stories object here) */ };

    // NOTE: keep your original STORIES object from your file.
    // I left this placeholder to keep this message shorter.
    // If you paste the full file, keep your STORIES exactly as it was.

    // =============================
    // Init
    // =============================
    (function init(){
      loadVoiceSetting();
      initVoices();

      // âœ… Eye-care init (global)
      kbBindEyeCare();

      // Language dropdown (site-wide)
      buildLanguageDropdown();
      window.addEventListener("online", buildLanguageDropdown);
      window.addEventListener("offline", buildLanguageDropdown);

      // Apply stored language to HTML lang on load
      const savedLang = localStorage.getItem("kb_siteVoiceLang") || "en";
      document.documentElement.lang = savedLang;

      // Stats
      setStatsUI();
      maybeBadge();

      // Words
      renderWords();

      // Alphabets
      buildAlphabet();

      // Stories
      // buildStoryPicker();
      // $("storyLang").onchange = ()=>{ buildStoryPicker(); speakKid("Story language changed."); };

      // Talking partner
      $("talkTopic").onchange = ()=> resetTalk();
      resetTalk();

      // Friendly greet
      if(!localStorage.getItem("kb_greeted_translator_v2")){
        localStorage.setItem("kb_greeted_translator_v2","1");
        setTimeout(() => speakKid("Welcome to language learning. Choose a tab to start."), 700);
      }
    })();
  </script>

  <!-- Keep your site translation script if you use it -->
  <script src="/lang.js" defer></script>
</body>
</html>